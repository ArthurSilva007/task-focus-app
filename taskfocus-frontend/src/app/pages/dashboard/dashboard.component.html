<div class="container-fluid">
  <h1 class="mb-4">Painel de Controle</h1>

  <!-- Cards de KPI -->
  <div class="row">
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card bg-dark text-white h-100">
        <div class="card-body">
          <div class="card-title">Total de Tarefas Ativas</div>
          <div class="display-4">{{ stats.totalTasks }}</div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card bg-dark text-white h-100">
        <div class="card-body">
          <div class="card-title">Tarefas Vencidas</div>
          <div class="display-4 text-danger">{{ stats.overdueTasks }}</div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card bg-dark text-white h-100">
        <div class="card-body">
          <div class="card-title">Concluídas Hoje</div>
          <div class="display-4 text-success">{{ stats.completedToday }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="row">
    <div class="col-lg-6 mb-4">
      <div class="card bg-dark text-white h-100">
        <div class="card-header">Tarefas por Estado</div>
        <div class="card-body">
          <app-pie-chart [chartData]="statusChartData" [chartLabels]="statusChartLabels"></app-pie-chart>
        </div>
      </div>
    </div>
  </div>

  <hr class="my-4">

  <!-- Secção de Tarefas -->
  <div class="d-flex justify-content-between align-items-center">
    <h2>As Minhas Tarefas</h2>
    <button type="button" class="btn btn-primary" (click)="openCreateModal()">
      <i class="bi bi-plus-lg"></i> Nova Tarefa
    </button>
  </div>

  <!-- Tabela de Tarefas -->
  <div class="table-responsive mt-3">
    <table class="table table-dark table-striped table-hover">
      <thead>
      <tr>
        <th>Título</th>
        <th>Estado</th>
        <th>Prioridade</th>
        <th>Data de Vencimento</th>
        <th>Ações</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let task of tasks">
        <td>{{ task.title }}</td>
        <td>{{ task.status }}</td>
        <td>{{ task.priority }}</td>
        <td>{{ task.dueDate | date:'dd/MM/yyyy' }}</td>
        <td>
          <button class="btn btn-sm btn-outline-primary me-2" (click)="openEditModal(task)">Editar</button>
          <button class="btn btn-sm btn-outline-danger" (click)="deleteTask(task.id)">Apagar</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal de Formulário de Tarefa -->
  <div class="modal fade" id="taskFormModal" #taskFormModal tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content bg-dark text-white">
        <div class="modal-header">
          <h5 class="modal-title">{{ currentTaskToEdit ? 'Editar Tarefa' : 'Criar Nova Tarefa' }}</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <app-task-form
            [taskToEdit]="currentTaskToEdit"
            (taskCreated)="handleTaskUpdate()"
            (taskUpdated)="handleTaskUpdate()">
          </app-task-form>
        </div>
      </div>
    </div>
  </div>
</div>
